{% extends "base.html" %}

{% block title %}{{ 'Editar' if uom else 'Nueva' }} Unidad de Medida - Sistema de Gestión{% endblock %}

{% block page_title %}{{ 'Editar' if uom else 'Nueva' }} Unidad de Medida{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('settings.list_uoms') }}" class="btn-custom btn-secondary-custom">
    <i class="bi bi-arrow-left"></i> Volver
</a>
{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr 340px; gap: var(--spacing-6);">
    <div>
        <div class="card-custom">
            <div class="card-header-custom">
                <h2 class="card-title">
                    {{ 'Editar Unidad' if uom else 'Crear Nueva Unidad' }}
                </h2>
            </div>
            <div class="card-body-custom">
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="form-group">
                        <label for="name" class="form-label-custom">
                            Nombre <span style="color: var(--color-danger);">*</span>
                        </label>
                        <input type="text" class="form-input-custom" id="name" name="name"
                            value="{{ uom.name if uom else '' }}" placeholder="Ej: Unidad, Metro, Kilogramo, Litro"
                            maxlength="80" required autofocus autocomplete="off"
                            hx-post="{{ url_for('settings.check_uom_name') }}" hx-trigger="keyup changed delay:500ms"
                            hx-target="#uom-name-error-container" hx-swap="outerHTML" hx-include="[name='uom_id']">
                        <input type="hidden" name="uom_id" value="{{ uom.id if uom else '' }}">
                        <div id="uom-name-error-container"></div>
                        <small
                            style="color: var(--color-text-muted); font-size: var(--font-size-xs); margin-top: var(--spacing-1); display: block;">
                            Nombre completo de la unidad de medida (máx. 80 caracteres)
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="symbol" class="form-label-custom">
                            Símbolo <span style="color: var(--color-danger);">*</span>
                        </label>
                        <input type="text" class="form-input-custom" id="symbol" name="symbol"
                            value="{{ uom.symbol if uom else '' }}" placeholder="Ej: ud, m, kg, l" maxlength="16"
                            required autocomplete="off">
                        <small
                            style="color: var(--color-text-muted); font-size: var(--font-size-xs); margin-top: var(--spacing-1); display: block;">
                            Abreviatura o símbolo (máx. 16 caracteres)
                        </small>
                    </div>

                    <div class="alert-custom alert-info" style="margin-top: var(--spacing-4);">
                        <i class="alert-custom-icon bi bi-info-circle"></i>
                        <div class="alert-custom-content">
                            <strong>Ejemplos:</strong>
                            <ul style="margin: var(--spacing-2) 0 0 0; padding-left: var(--spacing-4);">
                                <li><strong>Unidad</strong> (ud) - Para productos individuales</li>
                                <li><strong>Metro</strong> (m) - Para longitudes</li>
                                <li><strong>Kilogramo</strong> (kg) - Para peso</li>
                                <li><strong>Litro</strong> (l) - Para volumen</li>
                                <li><strong>Caja</strong> (caja) - Para embalajes</li>
                            </ul>
                        </div>
                    </div>

                    <div
                        style="display: flex; justify-content: flex-end; gap: var(--spacing-2); margin-top: var(--spacing-6);">
                        <a href="{{ url_for('settings.list_uoms') }}" class="btn-custom btn-secondary-custom">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                        <button type="submit" id="save-uom-btn" class="btn-custom btn-primary-custom">
                            <i class="bi bi-save"></i> {{ 'Actualizar' if uom else 'Crear' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div>
        <div class="card-custom" style="background-color: var(--color-bg-muted);">
            <div class="card-header-custom">
                <h2 class="card-title" style="font-size: var(--font-size-sm);">
                    <i class="bi bi-lightbulb"></i> Consejos
                </h2>
            </div>
            <div class="card-body-custom">
                <h6 style="margin-bottom: var(--spacing-2); font-weight: var(--font-weight-semibold);">¿Para qué sirven
                    las unidades de medida?</h6>
                <p
                    style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-2);">
                    Las unidades de medida definen cómo se cuantifican los productos en el sistema:
                </p>
                <ul
                    style="font-size: var(--font-size-sm); color: var(--color-text-secondary); padding-left: var(--spacing-4); margin-bottom: var(--spacing-4);">
                    <li><strong>Unidad:</strong> Productos que se venden individualmente (tornillos, herramientas, etc.)
                    </li>
                    <li><strong>Metro/Metro cuadrado:</strong> Productos que se venden por longitud o área (cables,
                        alfombras, etc.)</li>
                    <li><strong>Kilogramo:</strong> Productos que se venden por peso (clavos a granel, pintura, etc.)
                    </li>
                    <li><strong>Litro:</strong> Productos líquidos (solventes, selladores, etc.)</li>
                </ul>

                <hr style="border-color: var(--color-border-light); margin: var(--spacing-4) 0;">

                <h6 style="margin-bottom: var(--spacing-2); font-weight: var(--font-weight-semibold);">Restricciones
                    importantes:</h6>
                <ul
                    style="font-size: var(--font-size-sm); color: var(--color-text-secondary); padding-left: var(--spacing-4); margin: 0;">
                    <li>El nombre y símbolo deben ser únicos</li>
                    <li>Una vez asignada a productos, la unidad no puede eliminarse</li>
                    <li>Los productos siempre requieren una unidad de medida</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}