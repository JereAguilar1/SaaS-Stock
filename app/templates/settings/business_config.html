{% extends "base.html" %}

{% block title %}Configuración del Negocio - Sistema de Gestión{% endblock %}

{% block page_title %}Configuración del Negocio{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('settings.list_uoms') }}" class="btn-custom btn-secondary-custom">
    <i class="bi bi-arrow-left"></i> Volver
</a>
{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr 340px; gap: var(--spacing-6);">
    <div>
        <div class="card-custom">
            <div class="card-header-custom">
                <h2 class="card-title">
                    <i class="bi bi-shop"></i> Logo del Negocio
                </h2>
            </div>
            <div class="card-body-custom">
                <!-- Vista Previa del Logo Actual -->
                <div class="form-group">
                    <label class="form-label-custom">Logo Actual</label>
                    <div
                        style="background-color: var(--color-bg-muted); border: 1px dashed var(--color-border-medium); border-radius: var(--radius-md); padding: var(--spacing-6); text-align: center; min-height: 120px; display: flex; align-items: center; justify-content: center;">
                        {% if tenant.logo_url and logo_public_url %}
                        <img id="current-logo-preview" src="{{ logo_public_url }}" alt="Logo del negocio"
                            style="max-height: 80px; max-width: 100%; object-fit: contain;">
                        {% else %}
                        <div style="color: var(--color-text-muted);">
                            <i class="bi bi-image"
                                style="font-size: 2rem; display: block; margin-bottom: var(--spacing-2);"></i>
                            <span class="fs-5 fw-bold">{{ tenant.name }}</span>
                            <p style="margin-top: var(--spacing-2); font-size: var(--font-size-sm);">No hay logo
                                configurado</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Formulario de Subida de Logo -->
                <form method="POST" action="{{ url_for('settings.upload_logo') }}" enctype="multipart/form-data"
                    hx-post="{{ url_for('settings.upload_logo') }}" hx-target="#sidebar-logo" hx-swap="outerHTML"
                    hx-encoding="multipart/form-data">

                    <div class="form-group">
                        <label for="logo" class="form-label-custom">
                            Subir Nuevo Logo
                        </label>
                        <input type="file" class="form-input-custom" id="logo" name="logo"
                            accept="image/png,image/jpeg,image/jpg,image/svg+xml,image/webp" required
                            onchange="previewLogo(this)">
                        <small
                            style="color: var(--color-text-muted); font-size: var(--font-size-xs); margin-top: var(--spacing-1); display: block;">
                            Formatos permitidos: PNG, JPG, SVG, WebP (máx. 2MB)
                        </small>
                    </div>

                    <!-- Vista Previa del Nuevo Logo -->
                    <div id="logo-preview-container" style="display: none; margin-top: var(--spacing-4);">
                        <label class="form-label-custom">Vista Previa</label>
                        <div
                            style="background-color: var(--color-bg-muted); border: 1px solid var(--color-border-medium); border-radius: var(--radius-md); padding: var(--spacing-6); text-align: center; min-height: 120px; display: flex; align-items: center; justify-content: center;">
                            <img id="logo-preview" src="" alt="Vista previa"
                                style="max-height: 80px; max-width: 100%; object-fit: contain;">
                        </div>
                    </div>

                    <div class="alert-custom alert-info" style="margin-top: var(--spacing-4);">
                        <i class="alert-custom-icon bi bi-info-circle"></i>
                        <div class="alert-custom-content">
                            <strong>Recomendaciones:</strong>
                            <ul style="margin: var(--spacing-2) 0 0 0; padding-left: var(--spacing-4);">
                                <li>Tamaño recomendado: máximo 60px de altura</li>
                                <li>Fondo transparente para mejor visualización</li>
                                <li>Formato PNG o SVG preferido para calidad óptima</li>
                                <li>Evitar logos muy anchos (relación 3:1 máximo)</li>
                            </ul>
                        </div>
                    </div>

                    <div
                        style="display: flex; justify-content: flex-end; gap: var(--spacing-2); margin-top: var(--spacing-6);">
                        {% if tenant.logo_url %}
                        <button type="button" class="btn-custom btn-danger-custom"
                            hx-post="{{ url_for('settings.delete_logo') }}" hx-target="#sidebar-logo"
                            hx-swap="outerHTML" hx-confirm="¿Estás seguro de que deseas eliminar el logo?">
                            <i class="bi bi-trash"></i> Eliminar Logo
                        </button>
                        {% endif %}
                        <button type="submit" id="upload-logo-btn" class="btn-custom btn-primary-custom">
                            <i class="bi bi-upload"></i> Subir Logo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div>
        <div class="card-custom" style="background-color: var(--color-bg-muted);">
            <div class="card-header-custom">
                <h2 class="card-title" style="font-size: var(--font-size-sm);">
                    <i class="bi bi-lightbulb"></i> Consejos
                </h2>
            </div>
            <div class="card-body-custom">
                <h6 style="margin-bottom: var(--spacing-2); font-weight: var(--font-weight-semibold);">¿Por qué
                    personalizar tu logo?</h6>
                <p
                    style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-2);">
                    El logo de tu negocio aparecerá en:
                </p>
                <ul
                    style="font-size: var(--font-size-sm); color: var(--color-text-secondary); padding-left: var(--spacing-4); margin-bottom: var(--spacing-4);">
                    <li>Sidebar de la aplicación</li>
                    <li>Todas las páginas del sistema</li>
                    <li>Vistas de tu personal</li>
                </ul>

                <hr style="border-color: var(--color-border-light); margin: var(--spacing-4) 0;">

                <h6 style="margin-bottom: var(--spacing-2); font-weight: var(--font-weight-semibold);">Especificaciones
                    técnicas:</h6>
                <ul
                    style="font-size: var(--font-size-sm); color: var(--color-text-secondary); padding-left: var(--spacing-4); margin-bottom: var(--spacing-4);">
                    <li><strong>Formatos:</strong> PNG, JPG, SVG, WebP</li>
                    <li><strong>Tamaño máximo:</strong> 2MB</li>
                    <li><strong>Altura recomendada:</strong> 60px</li>
                    <li><strong>Proporción:</strong> Horizontal o cuadrado</li>
                </ul>

                <hr style="border-color: var(--color-border-light); margin: var(--spacing-4) 0;">

                <h6 style="margin-bottom: var(--spacing-2); font-weight: var(--font-weight-semibold);">Comportamiento:
                </h6>
                <ul
                    style="font-size: var(--font-size-sm); color: var(--color-text-secondary); padding-left: var(--spacing-4); margin: 0;">
                    <li>Sin logo: se muestra el nombre del negocio</li>
                    <li>Con logo: se muestra la imagen personalizada</li>
                    <li>Los cambios se reflejan inmediatamente</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    function previewLogo(input) {
        const previewContainer = document.getElementById('logo-preview-container');
        const preview = document.getElementById('logo-preview');
        const currentPreview = document.getElementById('current-logo-preview');

        if (input.files && input.files[0]) {
            const file = input.files[0];

            // Validar tamaño (2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('El archivo es demasiado grande. El tamaño máximo es 2MB.');
                input.value = '';
                previewContainer.style.display = 'none';
                return;
            }

            // Mostrar vista previa
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                previewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            previewContainer.style.display = 'none';
        }
    }
</script>
{% endblock %}