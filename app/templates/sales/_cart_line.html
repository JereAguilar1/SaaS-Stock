<div class="cart-item" id="cart-line-{{ line.product_id }}">
    <div class="cart-item-header">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <span class="cart-item-title">{{ line.product_name }}</span>
        </div>

        <form hx-post="{{ url_for('sales.draft_remove') }}" hx-target="#cart-container" hx-swap="innerHTML">
            <input type="hidden" name="product_id" value="{{ line.product_id }}">
            <button type="submit" class="btn-trash">
                <i class="bi bi-trash"></i>
            </button>
        </form>
    </div>

    <div class="cart-item-controls">
        <!-- Qty Control -->
        {% set uom_name = line.product_uom_name|lower %}
        {% set allow_decimal = 'kg' in uom_name or 'kilo' in uom_name or 'gram' in uom_name or 'mt' in uom_name or
        'metro' in uom_name or 'longitud' in uom_name %}

        <div class="qty-control">
            <form hx-post="{{ url_for('sales.draft_update') }}" hx-target="#cart-line-{{ line.product_id }}"
                hx-swap="outerHTML" class="d-inline">
                <input type="hidden" name="product_id" value="{{ line.product_id }}">
                <input type="hidden" name="qty" value="{{ line.qty - 1 }}">
                <button class="btn-qty" type="submit" {% if line.qty <=1 %}disabled style="opacity:0.5" {% endif
                    %}>âˆ’</button>
            </form>

            <input type="number" class="qty-input form-control form-control-sm border-0 text-center p-0 mx-1"
                style="width: 50px; background: transparent; font-weight: 600;" name="qty" value="{{ line.qty }}"
                data-product-id="{{ line.product_id }}" min="0.001" step="{{ '0.001' if allow_decimal else '1' }}"
                hx-post="{{ url_for('sales.draft_update') }}" hx-trigger="change delay:200ms, keyup[key=='Enter']"
                hx-target="#cart-line-{{ line.product_id }}" hx-swap="outerHTML"
                hx-vals='{"product_id": "{{ line.product_id }}"}'>

            <form hx-post="{{ url_for('sales.draft_update') }}" hx-target="#cart-line-{{ line.product_id }}"
                hx-swap="outerHTML" class="d-inline">
                <input type="hidden" name="product_id" value="{{ line.product_id }}">
                <input type="hidden" name="qty" value="{{ line.qty + 1 }}">
                <button class="btn-qty" type="submit">+</button>
            </form>
        </div>

        <div class="cart-item-price">
            ${{ line.line_total|default(0)|money_ar_2 }}
        </div>
    </div>

    {% if error_message and error_line_id == line.product_id|string %}
    <div class="text-danger small mt-1">
        <i class="bi bi-exclamation-circle me-1"></i> {{ error_message }}
    </div>
    {% endif %}
</div>