<div class="cart-item" id="cart-line-{{ line.product_id }}">
    <div class="cart-item-header">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <span class="cart-item-title">{{ line.product_name }}</span>
        </div>

        <form hx-post="{{ url_for('sales.draft_remove') }}" hx-target="#cart-container" hx-swap="innerHTML">
            <input type="hidden" name="product_id" value="{{ line.product_id }}">
            <button type="submit" class="btn-trash">
                <i class="bi bi-trash"></i>
            </button>
        </form>
    </div>

    <div class="cart-item-controls">
        <!-- Qty Control -->
        <div class="qty-control">
            <form hx-post="{{ url_for('sales.draft_update') }}" hx-target="#cart-line-{{ line.product_id }}"
                hx-swap="outerHTML" class="d-inline">
                <input type="hidden" name="product_id" value="{{ line.product_id }}">
                <input type="hidden" name="qty" value="{{ line.qty - 1 }}">
                <button class="btn-qty" type="submit" {% if line.qty <=1 %}disabled style="opacity:0.5" {% endif
                    %}>âˆ’</button>
            </form>

            <input type="number" class="qty-input form-control form-control-sm border-0 text-center p-0 mx-1"
                style="width: 50px; background: transparent; font-weight: 600;" name="qty" value="{{ line.qty|int }}"
                data-product-id="{{ line.product_id }}" min="1" step="1" hx-post="{{ url_for('sales.draft_update') }}"
                hx-trigger="change, blur, keyup[key=='Enter']" hx-target="#cart-line-{{ line.product_id }}"
                hx-swap="outerHTML" hx-vals='{"product_id": "{{ line.product_id }}"}'>

            <form hx-post="{{ url_for('sales.draft_update') }}" hx-target="#cart-line-{{ line.product_id }}"
                hx-swap="outerHTML" class="d-inline">
                <input type="hidden" name="product_id" value="{{ line.product_id }}">
                <input type="hidden" name="qty" value="{{ line.qty + 1 }}">
                <button class="btn-qty" type="submit">+</button>
            </form>
        </div>

        <div class="cart-item-price">
            ${{ "%.2f"|format(line.line_total) }}
        </div>
    </div>

    {% if error_message and error_line_id == line.product_id|string %}
    <div class="text-danger small mt-1">
        <i class="bi bi-exclamation-circle me-1"></i> {{ error_message }}
    </div>
    {% endif %}
</div>