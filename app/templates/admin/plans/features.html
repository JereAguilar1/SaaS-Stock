{% extends "admin/base_admin.html" %}

{% block content %}
<div class="container-xl">
    <div class="page-header d-print-none">
        <div class="row align-items-center">
            <div class="col">
                <div class="page-pretitle">
                    Administración de Planes
                </div>
                <h2 class="page-title">
                    Features: {{ plan.name }}
                </h2>
            </div>
            <div class="col-auto ms-auto d-print-none">
                <a href="{{ url_for('admin.list_plans') }}" class="btn btn-white">
                    Volver a Planes
                </a>
            </div>
        </div>
    </div>

    <div class="page-body">
        <div class="row row-cards">
            <!-- Formulario de Nueva Feature -->
            <div class="col-md-4">
                <form action="" method="post" class="card">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="card-header">
                        <h3 class="card-title">Agregar Feature</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label required">Clave (Key)</label>
                            <input type="text" class="form-control" name="feature_key" placeholder="Ej: module_sales"
                                required>
                            <small class="form-hint">Identificador único usado en el código.</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Valor (Opcional)</label>
                            <input type="text" class="form-control" name="feature_value" placeholder="Ej: 5">
                            <small class="form-hint">Para límites numéricos o configuraciones.</small>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <button type="submit" class="btn btn-primary">Agregar</button>
                    </div>
                </form>

                <div class="card mt-3">
                    <div class="card-body">
                        <h4 class="card-title">Features Comunes</h4>
                        <ul class="list-unstyled mb-0 text-muted small">
                            <li><code>module_sales</code> - Módulo de ventas</li>
                            <li><code>module_invoices</code> - Facturación electrónica</li>
                            <li><code>max_users</code> - Límite de usuarios</li>
                            <li><code>api_access</code> - Acceso a API</li>
                            <li><code>advanced_reports</code> - Reportes avanzados</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Lista de Features -->
            <div class="col-md-8">
                <div class="card">
                    <div class="table-responsive">
                        <table class="table card-table table-vcenter">
                            <thead>
                                <tr>
                                    <th>Clave</th>
                                    <th>Valor</th>
                                    <th>Estado</th>
                                    <th class="w-1"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for feature in features %}
                                <tr>
                                    <td>
                                        <span class="font-monospace">{{ feature.feature_key }}</span>
                                    </td>
                                    <td>
                                        {{ feature.feature_value or '-' }}
                                    </td>
                                    <td>
                                        {% if feature.is_active %}
                                        <span class="badge bg-success">Activo</span>
                                        {% else %}
                                        <span class="badge bg-secondary">Inactivo</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-list flex-nowrap">
                                            <form
                                                action="{{ url_for('admin.toggle_feature', plan_id=plan.id, feature_id=feature.id) }}"
                                                method="post" class="d-inline">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                <button type="submit" class="btn btn-white btn-sm btn-icon"
                                                    title="{% if feature.is_active %}Desactivar{% else %}Activar{% endif %}">
                                                    {% if feature.is_active %}
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                        height="24" viewBox="0 0 24 24" stroke-width="2"
                                                        stroke="currentColor" fill="none" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                        <rect x="6" y="5" width="4" height="14" rx="1" />
                                                        <rect x="14" y="5" width="4" height="14" rx="1" />
                                                    </svg>
                                                    {% else %}
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                        height="24" viewBox="0 0 24 24" stroke-width="2"
                                                        stroke="currentColor" fill="none" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                        <path d="M7 6v12" />
                                                        <path d="M18 6v12" />
                                                        <path d="M5 12h14" />
                                                    </svg>
                                                    {% endif %}
                                                </button>
                                            </form>
                                            <form
                                                action="{{ url_for('admin.delete_feature', plan_id=plan.id, feature_id=feature.id) }}"
                                                method="post" class="d-inline"
                                                onsubmit="return confirm('¿Estás seguro de eliminar esta feature?');">
                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                <button type="submit" class="btn btn-white btn-sm btn-icon text-danger"
                                                    title="Eliminar">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                        height="24" viewBox="0 0 24 24" stroke-width="2"
                                                        stroke="currentColor" fill="none" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                        <line x1="4" y1="7" x2="20" y2="7" />
                                                        <line x1="10" y1="11" x2="10" y2="17" />
                                                        <line x1="14" y1="11" x2="14" y2="17" />
                                                        <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                                        <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                                                    </svg>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <div class="text-muted">Este plan no tiene features configuradas.</div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}