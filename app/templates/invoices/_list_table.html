<div class="card-custom">
    {% if invoices %}
    <div class="table-container">
        <table class="table-custom">
            <thead>
                <tr>
                    <th style="width: 60px;">ID</th>
                    <th>Proveedor</th>
                    <th>Nº Boleta</th>
                    <th>Fecha</th>
                    <th>Vencimiento</th>
                    <th style="text-align: right;">Total / Pendiente</th>
                    <th style="text-align: center;">Estado</th>
                    <th style="text-align: center;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                <tr
                    style="{% if invoice.is_overdue and invoice.status.value != 'PAID' %}background-color: var(--color-danger-light);{% endif %}">
                    <td>{{ invoice.id }}</td>
                    <td><strong style="color: var(--color-text-primary);">{{ invoice.supplier.name }}</strong></td>
                    <td>
                        <span class="badge-custom badge-secondary">{{ invoice.invoice_number }}</span>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: var(--spacing-2);">
                            <i class="bi bi-calendar3" style="color: var(--color-text-muted);"></i>
                            {{ invoice.invoice_date|date_ar }}
                        </div>
                    </td>
                    <td>
                        {% if invoice.due_date %}
                        <div style="display: flex; align-items: center; gap: var(--spacing-2);">
                            {% if invoice.is_overdue and invoice.status.value != 'PAID' %}
                            <i class="bi bi-exclamation-triangle-fill" style="color: var(--color-danger);"></i>
                            <span style="color: var(--color-danger); font-weight: var(--font-weight-semibold);">{{
                                invoice.due_date|date_ar }}</span>
                            {% else %}
                            <i class="bi bi-calendar-event" style="color: var(--color-text-muted);"></i>
                            {{ invoice.due_date|date_ar }}
                            {% endif %}
                        </div>
                        {% else %}
                        <span style="color: var(--color-text-muted);">-</span>
                        {% endif %}
                    </td>
                    <td style="text-align: right;">
                        <div style="font-weight: var(--font-weight-semibold);">${{ invoice.total_amount|money_ar }}
                        </div>
                        {% if invoice.status.value != 'PAID' %}
                        <div style="font-size: var(--font-size-xs); color: var(--color-danger);">
                            Falta: ${{ (invoice.total_amount - invoice.paid_amount)|money_ar }}
                        </div>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">
                        {% if invoice.is_overdue and invoice.status.value != 'PAID' %}
                        <span class="badge-custom badge-danger">Caducada</span>
                        {% elif invoice.status.value == 'PENDING' %}
                        <span class="badge-custom badge-warning">Pendiente</span>
                        {% elif invoice.status.value == 'PARTIALLY_PAID' %}
                        <span class="badge-custom badge-info">Parcial</span>
                        {% else %}
                        <span class="badge-custom badge-success">Pagada</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="table-actions" style="justify-content: center;">
                            <a href="{{ url_for('invoices.view_invoice', invoice_id=invoice.id) }}"
                                class="btn-custom btn-secondary-custom btn-sm" title="Ver detalle">
                                <i class="bi bi-eye"></i>
                            </a>
                            {% if invoice.status.value != 'PAID' %}
                            <button type="button" class="btn-custom btn-warning-custom btn-sm" title="Pagar"
                                hx-get="{{ url_for('invoices.pay_invoice_preview', invoice_id=invoice.id) }}"
                                hx-target="#modal-container" hx-swap="innerHTML"
                                style="background-color: var(--color-warning-light); color: var(--color-warning-dark); border-color: var(--color-warning);">
                                <i class="bi bi-credit-card"></i>
                            </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card-footer-custom">
        <p style="margin: 0; font-size: var(--font-size-sm); color: var(--color-text-muted);">
            <strong>{{ invoices|length }}</strong> boleta(s) encontrada(s)
            {% if search_query %}
            para la búsqueda: <strong>"{{ search_query }}"</strong>
            {% endif %}
        </p>
    </div>
    {% else %}
    <div class="card-body-custom">
        <div class="empty-state">
            <i class="empty-state-icon bi bi-file-earmark-text"></i>
            <div class="empty-state-title">
                {% if search_query %}
                No se encontraron boletas
                {% else %}
                No hay boletas registradas
                {% endif %}
            </div>
            <p class="empty-state-description">
                {% if search_query %}
                No hay resultados para <strong>"{{ search_query }}"</strong>
                {% else %}
                Registre las facturas de sus proveedores para llevar el control.
                {% endif %}
            </p>
            {% if not search_query %}
            <a href="{{ url_for('invoices.new_invoice') }}" class="btn-custom btn-success-custom">
                <i class="bi bi-plus-circle"></i> Crear Primera Boleta
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>