{% extends "base.html" %}

{% block title %}Boleta #{{ invoice.id }} - Sistema Ferretería{% endblock %}

{% block page_title %}Boleta #{{ invoice.id }}{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('invoices.list_invoices') }}" class="btn-custom btn-secondary-custom">
    <i class="bi bi-arrow-left"></i> Volver al Listado
</a>
{% endblock %}

{% block content %}
<!-- Info Section -->
<div class="card-custom" style="margin-bottom: var(--spacing-6);">
    <div class="card-header-custom" style="background-color: var(--color-bg-muted);">
        <h5 class="card-title" style="font-size: var(--font-size-sm);">
            <i class="bi bi-info-circle"></i> Información General
        </h5>
    </div>
    <div class="card-body-custom">
        <dl
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-6); margin: 0;">
            <div>
                <dt
                    style="font-size: var(--font-size-xs); color: var(--color-text-secondary); text-transform: uppercase;">
                    Proveedor</dt>
                <dd
                    style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); margin-top: var(--spacing-1);">
                    {{ invoice.supplier.name }}
                </dd>
            </div>
            <div>
                <dt
                    style="font-size: var(--font-size-xs); color: var(--color-text-secondary); text-transform: uppercase;">
                    Nº Boleta</dt>
                <dd style="font-size: var(--font-size-md); margin-top: var(--spacing-1);">{{ invoice.invoice_number }}
                </dd>
            </div>
            <div>
                <dt
                    style="font-size: var(--font-size-xs); color: var(--color-text-secondary); text-transform: uppercase;">
                    Fecha</dt>
                <dd style="font-size: var(--font-size-md); margin-top: var(--spacing-1);">{{
                    invoice.invoice_date|date_ar }}</dd>
            </div>
            <div>
                <dt
                    style="font-size: var(--font-size-xs); color: var(--color-text-secondary); text-transform: uppercase;">
                    Vencimiento</dt>
                <dd style="margin-top: var(--spacing-1);">
                    {% if invoice.due_date %}
                    {{ invoice.due_date|date_ar }}
                    {% if invoice.is_overdue and invoice.status.value != 'PAID' %}
                    <span class="badge-custom badge-danger" style="margin-left: var(--spacing-2);">Vencida</span>
                    {% endif %}
                    {% else %}
                    -
                    {% endif %}
                </dd>
            </div>
            <div>
                <dt
                    style="font-size: var(--font-size-xs); color: var(--color-text-secondary); text-transform: uppercase;">
                    Estado</dt>
                <dd style="margin-top: var(--spacing-1);">
                    {% if invoice.status.value == 'PAID' %}
                    <span class="badge-custom badge-success">Pagada</span>
                    {% elif invoice.status.value == 'PARTIALLY_PAID' %}
                    <span class="badge-custom badge-info">Pago Parcial</span>
                    {% else %}
                    <span class="badge-custom badge-warning">Pendiente</span>
                    {% endif %}
                </dd>
            </div>
        </dl>
    </div>
</div>

<!-- Items Table -->
<div class="card-custom" style="margin-bottom: var(--spacing-6);">
    <div class="card-header-custom">
        <h5 class="card-title">Detalle de Ítems</h5>
    </div>
    <div class="table-container">
        <table class="table-custom">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>SKU</th>
                    <th>UOM</th>
                    <th style="text-align: right;">Cantidad</th>
                    <th style="text-align: right;">Costo Unit.</th>
                    <th style="text-align: right;">Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for line in invoice.lines %}
                <tr>
                    <td><strong style="color: var(--color-text-primary);">{{ line.product.name }}</strong></td>
                    <td>{{ line.product.sku or '-' }}</td>
                    <td><span class="badge-custom badge-info">{{ line.product.uom.symbol }}</span></td>
                    <td style="text-align: right;">{{ line.qty|num_ar }}</td>
                    <td style="text-align: right;">${{ line.unit_cost|money_ar }}</td>
                    <td style="text-align: right;"><strong style="color: var(--color-text-primary);">${{
                            line.line_total|money_ar }}</strong></td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot style="background-color: var(--color-bg-muted);">
                <tr>
                    <td colspan="5"
                        style="text-align: right; padding: var(--spacing-4); font-weight: var(--font-weight-bold);">
                        TOTAL BOLETA:
                    </td>
                    <td style="text-align: right; padding: var(--spacing-4);">
                        <span
                            style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); color: var(--color-success);">
                            ${{ invoice.total_amount|money_ar }}
                        </span>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<!-- Payment Alerts Container (for HTMX OOB swaps) -->
<div id="payment-alerts"></div>

<!-- Payments Section (HTMX Target) -->
{% include "invoices/_payments.html" %}

<!-- Modal Container -->
<div id="invoice-modal-container"></div>
{% endblock %}