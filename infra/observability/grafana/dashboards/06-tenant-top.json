{
    "annotations": {
        "list": []
    },
    "editable": true,
    "gnetId": null,
    "graphTooltip": 0,
    "id": null,
    "links": [],
    "panels": [
        {
            "datasource": "Prometheus",
            "gridPos": {
                "h": 4,
                "w": 24,
                "x": 0,
                "y": 0
            },
            "id": 1,
            "options": {
                "code": {
                    "language": "plaintext",
                    "showLineNumbers": false,
                    "showMiniMap": false
                },
                "content": "# Tenant Metrics Dashboard\n\n⚠️ **PENDING IMPLEMENTATION**: This dashboard requires tenant labels to be added to HTTP metrics.\n\n## How to Enable Tenant Metrics\n\n1. **Modify Flask Metrics Blueprint** (`app/blueprints/metrics.py`):\n   - Access `g.tenant_id` from Flask context in `after_request_metrics()`\n   - Add `tenant_id` label to metrics:\n     ```python\n     http_requests_total.labels(\n         method=method,\n         endpoint=endpoint,\n         http_status=status,\n         tenant_id=str(g.tenant_id) if g.tenant_id else 'none'\n     ).inc()\n     ```\n\n2. **Update Histogram Labels** similarly for `http_request_duration_seconds`\n\n3. **Restart Application** to apply changes\n\n4. **Update Dashboard Queries** below to filter by `tenant_id` label\n\n## Current State\n\nWithout tenant labels, this dashboard shows aggregate metrics for all tenants combined. The panels below use placeholder queries that will work once tenant labels are implemented.\n\n---\n",
                "mode": "markdown"
            },
            "pluginVersion": "9.0.0",
            "title": "Implementation Note",
            "type": "text"
        },
        {
            "datasource": "Prometheus",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "reqps"
                }
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 4
            },
            "id": 2,
            "options": {
                "legend": {
                    "calcs": [
                        "last"
                    ],
                    "displayMode": "table",
                    "placement": "bottom"
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "pluginVersion": "9.0.0",
            "targets": [
                {
                    "expr": "topk(10, sum by (tenant_id) (rate(http_requests_total[5m])))",
                    "legendFormat": "Tenant {{tenant_id}}",
                    "refId": "A"
                }
            ],
            "title": "Top Tenants by Requests/sec (Requires tenant_id label)",
            "type": "timeseries"
        },
        {
            "datasource": "Prometheus",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "yellow",
                                "value": 0.5
                            },
                            {
                                "color": "red",
                                "value": 1
                            }
                        ]
                    },
                    "unit": "s"
                }
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 4
            },
            "id": 3,
            "options": {
                "legend": {
                    "calcs": [
                        "last"
                    ],
                    "displayMode": "table",
                    "placement": "bottom"
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "pluginVersion": "9.0.0",
            "targets": [
                {
                    "expr": "topk(10, histogram_quantile(0.95, sum by (tenant_id, le) (rate(http_request_duration_seconds_bucket[5m]))))",
                    "legendFormat": "Tenant {{tenant_id}} - P95",
                    "refId": "A"
                }
            ],
            "title": "Top Tenants by Latency P95 (Requires tenant_id label)",
            "type": "timeseries"
        },
        {
            "datasource": "Prometheus",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "reqps"
                }
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 12
            },
            "id": 4,
            "options": {
                "legend": {
                    "calcs": [
                        "last"
                    ],
                    "displayMode": "table",
                    "placement": "bottom"
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "pluginVersion": "9.0.0",
            "targets": [
                {
                    "expr": "topk(10, sum by (tenant_id) (rate(http_requests_total{http_status=~\"5..\"}[5m])))",
                    "legendFormat": "Tenant {{tenant_id}} - 5xx errors",
                    "refId": "A"
                }
            ],
            "title": "Top Tenants by 5xx Errors (Requires tenant_id label)",
            "type": "timeseries"
        },
        {
            "datasource": "Prometheus",
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "align": "auto",
                        "displayMode": "auto"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    }
                }
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 12
            },
            "id": 5,
            "options": {
                "footer": {
                    "fields": "",
                    "reducer": [
                        "sum"
                    ],
                    "show": false
                },
                "showHeader": true,
                "sortBy": [
                    {
                        "desc": true,
                        "displayName": "Requests/sec"
                    }
                ]
            },
            "pluginVersion": "9.0.0",
            "targets": [
                {
                    "expr": "sum by (tenant_id) (rate(http_requests_total[5m]))",
                    "format": "table",
                    "instant": true,
                    "refId": "A"
                }
            ],
            "title": "All Tenants Summary (Requires tenant_id label)",
            "transformations": [
                {
                    "id": "organize",
                    "options": {
                        "excludeByName": {
                            "Time": true
                        },
                        "indexByName": {},
                        "renameByName": {
                            "Value": "Requests/sec",
                            "tenant_id": "Tenant ID"
                        }
                    }
                }
            ],
            "type": "table"
        }
    ],
    "schemaVersion": 36,
    "style": "dark",
    "tags": [
        "saas-stock",
        "tenants",
        "multi-tenant"
    ],
    "templating": {
        "list": []
    },
    "time": {
        "from": "now-1h",
        "to": "now"
    },
    "timepicker": {},
    "timezone": "",
    "title": "06 - Tenant Metrics (PLACEHOLDER)",
    "uid": "saas-stock-tenants",
    "version": 1
}